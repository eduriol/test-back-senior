# Test Back Senior by Eduardo Riol
A set of executable Gherkin scenarios written in Java to test the [Search Contacts API](https://developer.aircall.io/api-references/#search-contacts).
## Requirements
- [Java](https://jdk.java.net/) 17+
- [Maven](https://maven.apache.org/download.cgi) 3.6.3+
- Have a valid Aircall API account. 

Alternatively, in the case of using the [Docker execution](#docker-execution), you don't need to have Java or Maven installed.
### Test plan & tools selection
The test plan has been defined in the format of a set of scenarios following the __Gherkin__ syntax (Given / When / Then). It can be found in the following file:
`src/test/resources/com/github/test/back/senior/searchContact.feature`

The reasoning for this choice is that, using __Cucumber__, we can directly automate the test plan as a set of executable scenarios, emulating a BDD (Behaviour Driven Development) approach.

Also, __Java__ is one of the programming languages which I have more experience with, and using the library __REST Assured__, we can leverage a nice fluent API to test backend services.
## Run the scenarios
As usual, first step is cloning the repo :)
```
git clone https://github.com/eduriol/test-back-senior.git
cd test-back-senior
```
### Local execution
For security reasons, the API id and API token are not stored anywhere. You need to set them beforehand as environment variables in order to successfully execute the scenarios:
```
export API_ID=<API_ID>
export API_TOKEN=<API_TOKEN>
```
Once this is done you can run the scenarios by simply running the following command:
```
mvn test
```
### Docker execution
#### Build Docker image
```
sudo docker build --tag="test-back-senior:latest" .
```
#### Run Docker image
In the case of Docker execution, you need to pass the environment variables within the run command:
```
sudo docker run --env API_ID=<API_ID> --env API_TOKEN=<API_TOKEN> -it test-back-senior:latest
```
### Reports
The report showing the result of the scenarios execution can be seen in the standard output.

Alternatively, it can be seen in a friendly and usable way in the html report generated in the `target/cucumber-reports.html` file within the project.

This file could be later deployed to a server for visualization using a CI pipeline.
## Manually test API
To perform a basic manual GET petition to _Contact API_, you can execute the following cURL command:
```
curl --request GET '{{host}}/v1/contacts/search?order=asc&order_by=created_at&phone_number={{phone_number}}' \
--header 'Authorization: Basic {{token}}'
```
Or import into Postman the collection contained in the __Contact_API.postman_collection.json__ file. It contains a basic call to _Search contact_ endpoint.
Either when using the cURL command or the Postman collection, remember to update the values enclosed within {{}}.

The {{token}} value can be generated by concatenating your API id, a colon character (:) and your API token, and encoding it using any [online Base64 encoding service](https://www.base64encode.org/).

## Issues found
During the completion of the tests, the following findings were made:
- In [the documentation](https://developer.aircall.io/api-references/#basic-auth-aircall-customers), it says _"click on Add a new API key and get your api_token and api_token"_. It should probably be __api_id__ and __api_token__.
- When the contacts array returned is empty, we get a 200 status response. Should we be getting a 204 (no content) response instead?
- When we make a Search request with the _from_ query parameter being a later timestamp than the _to_ query parameter I get an empty 200 response. Should we be getting a 400 Bad request instead since _from_ should always be earlier than _to_? (See __Scenario: Wrong periods - Search contact with from > to__ in `src/test/resources/com/github/test/back/senior/searchContact.feature`, which is currently ignored).
- Same as in the previous finding, the __Scenario: Wrong email - Search contact with badly formatted email__ has been ignored because is currently failing due to the API successfully responding to a wrongly formatted email.

A discussion to confirm whether these findings are real issues is recommended.
## Contribution
If you'd like to contribute to the project, please send a [Pull Request](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests) or contact eduriol [at] gmail.com.
